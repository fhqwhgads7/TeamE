<html>
<head>
	<title>Background and Music</title>
	
		<script src="../js/jquery.js"></script>
		<script src="../js/shared.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/shared.css"></link>
		<script src = "http://code.jquery.com/jquery-2.1.0.min.js"></script>
	
	<script>
		var currentTime;
		var currentBGM;
		
		function Initialize()
		{
			currentTime = getTimeOfDay(new Date().getHours());
			$("#OverBackground").css('background-image',$("#MainBackground").css('background-image'));
			setInterval(backgroundThink,1000);
		}
		function backgroundThink()
		{
			var nextTime = getTimeOfDay(new Date().getHours());
			if (currentTime != nextTime){
				fadeToNextBackground();
				currentTime = nextTime;
			}
		}
		function BGMThink()
		{
			var nextBGM = localStorage.getItem("CurrentBGM");
			if (!nextBGM)
			{
				changeCurrentBGM("Menu");
				currentBGM = localStorage.getItem("CurrentBGM");
			}
			else if (currentBGM != nextBGM)
			{
				currentBGM = nextBGM;
			}
		}
		function fadeToNextBackground()
		{
			$("#OverBackground").css('opacity','0');
			setTimeout(function(){
				$("#OverBackground").css('background-image',$("#MainBackground").css('background-image')); 
				$("#OverBackground").css('opacity','100');
			},2050);
		}
		
		function bgmPlayer(){
			jQuery(function($) {

				var supportsAudio = !!document.createElement('audio').canPlayType;
				if(supportsAudio) {
					var playing = false;
					mediaPath = '/assets/',
					extension = '.mp3',
					tracks = [
						{"track":1,"name":"Track 1","file":"1"},
						{"track":2,"name":"Track 2","file":"2"},
						{"track":3,"name":"Track 3","file":"3"},
					],
					trackCount = tracks.length,
					index = Math.floor(Math.random()*trackCount),
					npAction = $('#npAction'),
					npTitle = $('#npTitle'),
					audio = $('#audio1').bind('play', function() {
						playing = true;
						npAction.text('Now Playing:');
					}).bind('pause', function() {
						playing = false;
						npAction.text('Paused:');
					}).bind('ended', function() {
						npAction.text('Paused:');
						
						var curIndex = index;
						
						do{
						
							index = Math.floor(Math.random()*trackCount)
						
						}while(index == curIndex);
						
						loadTrack(index);
							audio.play();
						
						
					}).get(0),
					loadTrack = function(id) {
						npTitle.text(tracks[id].name);
						index = id;
						audio.src = tracks[id].file + extension;
					},
					playTrack = function(id) {
						loadTrack(id);
						audio.play();
					};

					if(audio.canPlayType('audio/ogg')) {
						extension = '.ogg';
					}
					if(audio.canPlayType('audio/mpeg')) {
						extension = '.mp3';
					}
					loadTrack(index);
					audio.play();
				}
			});
		}
		
	</script>
	
	<style>
	#OverBackground{
		position:fixed;
		top:0px;
		left:0px;
		width:800px;
		height:600px;
		overflow:hidden;
		transition: opacity 2s ease-in-out;
	}
	</style>
	
</head>

<body onload="Initialize()">
	<div id="MainBackground" style="z-index:-999">
	</div>
	
	<div id="OverBackground" style="z-index:-10">
	</div>
	
		<div id="cwrap">
			<div id="audiowrap">
				<div id="audio0">
					<audio id="audio1">
						Your browser does not support the HTML5 Audio Tag.
					</audio>
				</div>
			</div>
		</div>
</body>
</html>