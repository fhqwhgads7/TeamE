<!DOCTYPE html>

<html>
	<head>
		<script src="https://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
		<script src="../js/jquery.js"></script>
		<script src="../js/shared.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/shared.css"></link>

		<script>
		Parse.initialize("xjUxyY8bghFGuSnM3ptEZkV3BiWOlD3VhkRLt4kz", "iZCS2S7ZuWn9keMoooLaHMlB7HMXpcqD1M60JVjp");
		
		var user = new Parse.User();
		
		// other fields can be set just like with Parse.Object
		//user.set("phone", "650-555-0000");
		
			function Initialize()
			{
				GlobalInitialize();
			}
			function GoBackToMainMenu()
			{
				SwitchToPage("title.html");
			}
			function SubmitRegistration(){
				
			    if ($("#Username").val().length < 6){
					ShowAlert("Username must be at least 6 characters long.", "fail.png");
					playSound(GameSounds.Wrong_BAD);
				}
				else if ($("#Password").val().length < 6){
					ShowAlert("Password must be at least 6 characters long.", "fail.png");
					playSound(GameSounds.Wrong_BAD);
				}
				else if ($("#Password").val().length != $("#reenterPassword").val().length){
					ShowAlert("Passwords do not match.", "fail.png");
					playSound(GameSounds.Wrong_BAD);
				}
				else if (!IsValidEmailAddress($("#Email").val())){
					ShowAlert("Invalid email address.", "fail.png");
					playSound(GameSounds.Wrong_BAD);
				}
				else {
					var inputUsername = $("#Username").val();
					var inputPassword = $("#Password").val();
					var inputRepeatPassword = $("#reenterPassword")
					var inputEmail = $("#Email").val();
					playSound(GameSounds.ButtonSelect);
					
					user.set("username", inputUsername);
					user.set("password", inputPassword);
					user.set("email", inputEmail);
					
					ShowAlert("Registering...", "loading_thing.gif");

					user.signUp(null, {
						success: function(user) {
							ShowAlert("You have been successfully registered!", "success.png");
							$("#AlertButton").attr('onclick', 'CloseAndSwitch()');
						},
						error: function(user, error) {
							ShowAlert("Error: " + " " + error.message, "fail.png");
						}
					});
					
					
				}
			}
			function IsValidEmailAddress(sEmail) {
				var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
				return filter.test(sEmail);
			}
			function ShowAlert(){
				$("#AlertOverlay").show();
				$("#Alerts").show();
			}
			function ShowAlert(message, image){
				$("#AlertOverlay").show();
				$("#Alerts").show();
				$("#AlertMessage").text(message);
				$("#AlertImage").attr('src', "../images/icons/" + image);
			}
			function CloseAlert() {
				$("#AlertOverlay").hide();
				$("#Alerts").hide();
			}
			function CloseAndSwitch() {
				$("#AlertOverlay").hide();
				$("#Alerts").hide();
				GoBackToMainMenu();
			}
			
			//Not done yet still working on SaveStats function
		    function SaveStats(){
				var FinalStats=Parse.Object.extend("FinalStats");
				var finalStats=new FinalStats();
		
				finalStats.set("playerName", user);
				finalStats.set("gamesplayed", user);
				finalStats.set("gameswon", user);
				finalStats.set("winpercent", user);
				finalStats.set("totaldollars", user);
		
				finalStats.save(null, {
					success: function(finalStats) {
					alert('New object created with objectId: ' + finalStats.id);
					},
					error: function(finalStats, error) {

					alert('Failed to create new object, with error code: ' + error.description);
					}
				});
			}		
			
		</script>
		<style>
			div.OptionsBox{
				position:absolute;
				border-style:solid;
				border-width:5px;
				width:60%;
				height:60%;
				box-shadow: 0px 0px 40px 5px #AAAAAA;
				background-color:rgba(0,0,0,.8);
			}
			div.OptionsBox:hover{
				background-color:rgba(0,0,0,.6);
			}
			.Options{
				position:absolute;
				right:3%;
				width:28%;
				font-family:"Arial";
				font-size:15px;
				font-weight:900;
			}
			.roundSlider{
				position:absolute;
				width:100px;
			}
			button.Smaller{
				outline:none;
				position:absolute;
				padding:0.4em 2em;
				font-size:0.8em;
				font-family:Arial;
				background:rgba(255,255,255,0.75);
				color:rgba(0,0,0,0.7);
				text-shadow:1px 1px 0 rgba(255,255,255,0.1);
				text-decoration:none;
				border:solid 1px rgba(20,20,20,1);
				border-radius:10px;
				box-shadow:inset 1px 1px 1px rgba(255,255,255,0.05),inset 0 0 35px rgba(0,0,0,0.6),0 10px 10px -6px rgba(0,0,0,0.75);
			}
			button.Smaller:hover {
				background:rgba(255,255,255,1);
				box-shadow:inset 1px 1px 1px rgba(255,255,255,0.05),inset 0 0 35px rgba(0,0,0,0.6),0 10px 10px -6px rgba(0,0,0,1);
			}
			button.Smaller:active {
				top:5px;
				box-shadow:inset 0 1px 1px rgba(0,0,0,0.4),inset 0 0 35px rgba(0,0,0,0.6),0 1px 1px rgba(255,255,255,0.1),inset 0 6px 4px rgba(0,0,0,0.4);
			}

		</style>
	</head>


	<body onload="Initialize()">
		<div id="MainBackground">
			<div id="ContentContainer">
				<div class="FancyText" id="StartNewGameTitle" style="margin:0px;width:100%;top:20%;">Register</div> 
				
				<div id="ButtonSheetOne" class="ButtonSheet" style="height:100%">
					
					<input type="text" id="Username" class="OneColumn" placeholder="Username" style="overflow:hidden;resize:none;top:39%;left:32%;height:5%;width:35.5%;"></input>
					<input type="password" id="Password"  class="OneColumn" placeholder="Password" style="overflow:hidden;resize:none;top:46%;left:32%;height:5%;width:35.5%;"></input>
					<input type="password" id="reenterPassword" input type="password" class="OneColumn" placeholder="Re-Enter Password" style="overflow:hidden;resize:none;top:53%;left:32%;height:5%;width:35.5%;"></input>
					<input type="text" id="Email" class="OneColumn" placeholder="Email" style="overflow:hidden;resize:none;top:60%;left:32%;height:5%;width:35.5%;"></input>
					<button class="Standard" style="left:34%;top:67%;width:32%" onclick="SubmitRegistration(); noSound();">Register</button>
					<button class="Standard" onclick="GoBackToMainMenu()" style="left:34%;top:77%;width:32%">Main Menu</button>
				</div>
					
				<div class="PopupOverlay" id="AlertOverlay">
					<div class="Popup" id="Alerts" style="left:30%;width:40%;top:30%;height:40%">
						<img id="AlertImage" src="../images/icons/fail.png" style="position:absolute;left:34%;top:5%;width:100px;height:100px"></img>
						<div class="StandardText" id="AlertMessage" style="font-size:12px;margin:0px;width:100%;top:58%;">Failing...</div>															
						<button class="Standard" id="AlertButton" onclick="CloseAlert()" style="top:70%;left:20%;width:60%">OK</button>
					</div>
				</div>
				
				</div>
			</div>
		</div>
	</body>
</html>
